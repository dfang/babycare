<div class="weui-cells">
  <div class="weui-cell">
    <div class="weui-cell__bd">
        <p>期望时间</p>
    </div>
    <div class="weui-cell__ft"><%= resource.p_date %></div>
  </div>

  <div class="weui-cell">
    <div class="weui-cell__bd">
        <p>患者位置</p>
    </div>
    <div class="weui-cell__ft">
      <%= resource.p_location %>
    </div>
  </div>

  <%= link_to chief_complains_doctors_reservations_path(id: resource), class: 'weui-cell weui-cell_access' do %>
        <div class="weui-cell__bd">
            <p>症状描述</p>
        </div>
        <div class="weui-cell__ft"><%= resource.chief_complains %></div>
  <% end %>
</div>


<div class="weui-cells">
  <div class="weui-cell">
    <div class="weui-cell__hd">
      <p>预约时间</p>
    </div>
    <div class="weui-cell__bd weui-cell_primary">
      <input class="weui-input" name="reservation[d_date]" placeholder="患者来见你的时间" type="datetime-local"  data-parsley-required="true">
    </div>
  </div>

  <div class="weui-cell">
    <div class="weui-cell__hd">
      <p>预约地点</p>
    </div>
    <div class="weui-cell__bd weui-cell_primary">
      <input class="weui-input" name="reservation[d_location]" placeholder="患者来见你的位置" type="text"  data-parsley-required="true">
    </div>
  </div>
</div>

<div class="weui-cells weui-cells_form">

  <div class="weui-cell weui-cell_switch">
      <div class="weui-cell__bd">检查项目</div>
      <div class="weui-cell__ft">
        <% if resource.reservation_examinations.any? %>
          <input class="weui-switch" type="checkbox" checked>
        <% else %>
          <input class="weui-switch" type="checkbox">
        <% end %>
      </div>
  </div>

  <% if resource.reservation_examinations.any? %>
    <% resource.reservation_examinations.each do |re| %>
      <div class="weui-cell add-examinations">
        <div class="weui-cell__bd">
        <%= re.examination.name %>
        </div>
      </div>
    <% end %>
  <% end %>

  <% if resource.reservation_examinations.any? %>
    <%= link_to edit_doctors_examination_path(reservation_id: resource), class: "weui-cell weui-cell_access add-examinations" do %>
      <div class="weui-cell__bd">
        <p>修改检查项目</p>
      </div>
      <div class="weui-cell__ft">
      </div>
    <% end %>
  <% else %>
    <%= link_to new_doctors_examination_path(reservation_id: resource), class: "weui-cell weui-cell_access add-examinations" do %>
      <div class="weui-cell__bd">
        <p>添加检查项目</p>
      </div>
      <div class="weui-cell__ft">
      </div>
    <% end %>
  <% end %>


</div>


<div class="weui-btn-area">
  <%= link_to "接单", '', class: 'weui-btn weui-btn_primary btn-claim', data: { turbolinks: "false" } %>
  <%= link_to "拒单", '', class: 'weui-btn weui-btn_default', data: { turbolinks: "false" } %>
  <a href="javascript: IM.call(<%= current_user.id %>, <%= resource.doctor_id %>, <%= resource.id %>, <%= current_user.doctor.mobile_phone %>, <%= resource.patient_user_phone %>);" class="weui-btn weui-btn_default">拨打患者电话</a>
</div>

<%= content_for :js do %>
  <%= javascript_tag do %>
    $(function(){

      $(document).on('click', '.btn-claim', function(e){
        e.preventDefault();
        $.ajax({
          url: '<%= doctors_reservation_path(resource) %>',
          type: 'PUT',
          data: {
            reservation:{
              d_location: $('input[name="reservation[d_location]"]').val(),
              d_date: $('input[name="reservation[d_date]"]').val(),
              examinations: $('.weui-switch').val(),
              event: 'claim'
            }
          }
        }).done(function(data, textStatus, jqXHR) {
            console.log("success");
        }).fail(function(jqXHR, textStatus, errorThrown) {
            console.log("error");
        }).always(function(data, textStatus, jqXHR) {
            console.log("complete");
        })
      });

      $('.add-examinations').hide();
      $('.weui-switch').change(function(e){
        $('.add-examinations').toggle();
      });

      <% if resource.reservation_examinations.any? %>
        $('.add-examinations').show();
      <% end %>
    })
  <% end %>
<% end %>
