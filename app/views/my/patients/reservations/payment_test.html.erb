
<div class="msg">
    <div class="weui-msg">
        <div class="weui-msg__icon-area"><i class="weui-icon-info weui-icon_msg"></i></div>
        <div class="weui_text_area">
            <h2 class="weui-msg__title">支付定金</h2>
            <p class="weui-msg__desc">请支付定金以示你的诚意!</p>
        </div>
        <div class="weui-msg__opr-area">
            <p class="weui-btn-area">
                <a href="javascript:void(0)" class="weui-btn weui-btn__primary" id="wechatPaymentBtn">支付定金</a>
            </p>
        </div>
        <div class="weui-msg__extra-area">
            <a href="">帮助</a>
        </div>
    </div>
</div>

<%= javascript_tag do %>
  if (typeof WeixinJSBridge == "undefined"){
     if( document.addEventListener ){
         document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
     }else if (document.attachEvent){
         document.attachEvent('WeixinJSBridgeReady', onBridgeReady);
         document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
     }
  }else{
     onBridgeReady();
  }

  var orderParams = {
    appId:     "<%= @order_params[:app_id] %>",
    timeStamp: "<%= @order_params[:timestamp] %>",
    nonceStr:  "<%= @order_params[:nonce_str] %>",
    package:   "<%= @order_params[:package] %>",
    paySign:   "<%= @order_params[:pay_sign] %>",
    signType:  "<%= @order_params[:sign_type] %>"
  };

  function onBridgeReady(){
    alert('device ready, click to pay')
    $('#wechatPaymentBtn').click(function() {
      WeixinJSBridge.invoke('getBrandWCPayRequest', orderParams, function(res) {
        if (res.err_msg == "get_brand_wcpay_request:ok") {
          alert('pay for success!');
        } else {
          alert(res.err_msg);
        }
      });
    });
  }
<% end %>
